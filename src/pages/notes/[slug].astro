---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

const dateFormatter = new Intl.DateTimeFormat('en-US', {
  month: 'short',
  day: 'numeric',
  year: 'numeric',
});

export async function getStaticPaths() {
  const notes = await getCollection('notes');
  return notes.map((note) => ({
    params: { slug: note.slug },
    props: { note },
  }));
}

const { note } = Astro.props as { note: CollectionEntry<'notes'> };
const { Content } = await note.render();
---
<BaseLayout pageTitle={note.data.title}>
  <article class="mx-auto max-w-4xl space-y-8">
    <header class="grimoire-card hero-glow p-6 md:p-8">
      <p class="section-title">Spellbook Note</p>
      <h2 class="mt-3 text-4xl font-semibold tracking-tight md:text-5xl">{note.data.title}</h2>
      <p class="mt-4 leading-relaxed text-[color:var(--muted)]">{note.data.summary}</p>
      <div class="mt-5 flex flex-wrap gap-2">
        <span class="sigil-badge">{note.data.domain}</span>
        <span class="sigil-badge">{dateFormatter.format(note.data.publishedAt)}</span>
      </div>
      <div class="mt-3 flex flex-wrap gap-2">
        {note.data.tags.map((tag) => (
          <span class="sigil-badge">{tag}</span>
        ))}
      </div>
    </header>

    <section class="markdown grimoire-card p-6 md:p-8">
      <Content />
    </section>

    <div>
      <a href="/notes" class="rune-link text-sm font-semibold uppercase tracking-[0.1em]">Back to Notes</a>
    </div>
  </article>
</BaseLayout>
